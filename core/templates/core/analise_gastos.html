{% extends 'core/base.html' %}

{% block title %}Análise de Gastos{% endblock %}

{% block content %}
<h1 class="mb-4">Análise de Gastos do Mês</h1>

<div class="row">
    <div class="col-md-6">
        <div class="card">
            <div class="card-body">
                <canvas id="gastosPorCategoriaChart"></canvas>
            </div>
        </div>
    </div>

    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                Resumo por Categoria
            </div>
            <table class="table mb-0">
                <thead>
                    <tr>
                        <th>Categoria</th>
                        <th>Total Gasto</th>
                    </tr>
                </thead>
                <tbody>
                    {% for gasto in gastos_por_categoria %}
                    <tr>
                        <td>{{ gasto.categoria__nome }}</td>
                        <td>R$ {{ gasto.total|floatformat:2 }}</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="2" class="text-center">Nenhum gasto registrado este mês.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
    // Passando os dados do Django para o JavaScript de forma segura
    const labels = {{ labels|safe }};
    const data = {{ data|safe }};

    const ctx = document.getElementById('gastosPorCategoriaChart');

    new Chart(ctx, {
        type: 'doughnut', // Tipo do gráfico: rosca (ou 'pie' para pizza)
        data: {
            labels: labels,
            datasets: [{
                label: 'Gastos por Categoria',
                data: data,
                backgroundColor: [ // Paleta de cores para os segmentos
                    'rgba(255, 99, 132, 0.8)',
                    'rgba(54, 162, 235, 0.8)',
                    'rgba(255, 206, 86, 0.8)',
                    'rgba(75, 192, 192, 0.8)',
                    'rgba(153, 102, 255, 0.8)',
                    'rgba(255, 159, 64, 0.8)',
                    'rgba(199, 199, 199, 0.8)',
                    'rgba(83, 102, 255, 0.8)'
                ],
                borderColor: 'rgba(255, 255, 255, 1)',
                borderWidth: 2
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    position: 'top',
                },
                title: {
                    display: true,
                    text: 'Distribuição de Gastos do Mês'
                }
            }
        }
    });
</script>
{% endblock %}